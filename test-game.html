<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Spikepulse</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #0F0F0F;
            color: white;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        #status {
            background: #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Test Spikepulse Core</h1>
    <div id="status">Estado: Inicializando...</div>
    
    <button onclick="testConfig()">Test Config</button>
    <button onclick="testEventBus()">Test EventBus</button>
    <button onclick="testStateManager()">Test StateManager</button>
    <button onclick="testGameEngine()">Test GameEngine</button>
    
    <div id="output"></div>

    <script type="module">
        import { ConfigManager } from './src/core/ConfigManager.js';
        import { EventBus } from './src/core/EventBus.js';
        import { StateManager } from './src/core/StateManager.js';
        import { GameEngine } from './src/core/GameEngine.js';
        import { getFullConfig } from './src/config/GameConfig.js';

        const output = document.getElementById('output');
        const status = document.getElementById('status');

        function log(message) {
            output.innerHTML += '<div>' + message + '</div>';
            console.log(message);
        }

        // Test ConfigManager
        window.testConfig = function() {
            log('=== Testing ConfigManager ===');
            const config = new ConfigManager(getFullConfig());
            log('Config created: ' + (config ? 'OK' : 'FAIL'));
            log('Canvas width: ' + config.get('canvas.width'));
            log('Player gravity: ' + config.get('player.physics.gravity'));
        };

        // Test EventBus
        window.testEventBus = function() {
            log('=== Testing EventBus ===');
            const eventBus = new EventBus();
            let received = false;
            
            eventBus.on('test', () => { received = true; });
            eventBus.emit('test');
            
            log('EventBus test: ' + (received ? 'OK' : 'FAIL'));
        };

        // Test StateManager
        window.testStateManager = function() {
            log('=== Testing StateManager ===');
            const eventBus = new EventBus();
            const stateManager = new StateManager(eventBus);
            
            stateManager.registerState('test', {
                onEnter: () => log('Entered test state'),
                allowedTransitions: []
            });
            
            const success = stateManager.changeState('test');
            log('StateManager test: ' + (success ? 'OK' : 'FAIL'));
        };

        // Test GameEngine
        window.testGameEngine = function() {
            log('=== Testing GameEngine ===');
            try {
                // Crear un canvas temporal para el test
                const canvas = document.createElement('canvas');
                canvas.id = 'gameCanvas';
                canvas.width = 800;
                canvas.height = 400;
                document.body.appendChild(canvas);
                
                const engine = new GameEngine(getFullConfig());
                log('GameEngine created: OK');
                
                engine.start();
                log('GameEngine started: OK');
                
                setTimeout(() => {
                    const stats = engine.getStats();
                    log('Current state: ' + stats.currentState);
                    log('Is running: ' + stats.isRunning);
                    log('FPS: ' + stats.fps);
                }, 1000);
                
            } catch (error) {
                log('GameEngine test FAILED: ' + error.message);
            }
        };

        status.textContent = 'Estado: Listo para pruebas';
    </script>
</body>
</html>