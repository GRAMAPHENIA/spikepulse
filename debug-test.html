<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test - Spikepulse</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #0F0F0F;
            color: white;
        }
        .debug-panel {
            background: #1A1A2E;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
        }
        button {
            background: #FFD700;
            color: #0F0F0F;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #FFA500;
        }
        .error {
            color: #FF6B6B;
            background: #2D1B1B;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            color: #38A169;
            background: #1B2D1B;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .log {
            background: #2D3748;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>🔧 Debug Test - Spikepulse</h1>
    
    <div class="debug-panel">
        <h2>Pruebas de Módulos</h2>
        <button onclick="testBasicImports()">Probar Importaciones Básicas</button>
        <button onclick="testGameEngine()">Probar GameEngine</button>
        <button onclick="testEventBus()">Probar EventBus</button>
        <button onclick="testConfigManager()">Probar ConfigManager</button>
        <button onclick="clearLog()">Limpiar Log</button>
    </div>

    <div class="debug-panel">
        <h2>Estado del Sistema</h2>
        <div id="systemStatus">Esperando pruebas...</div>
    </div>

    <div class="debug-panel">
        <h2>Log de Debug</h2>
        <div id="debugLog" class="log">Iniciando debug...\n</div>
    </div>

    <script type="module">
        let debugLog = document.getElementById('debugLog');
        let systemStatus = document.getElementById('systemStatus');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            debugLog.textContent += logEntry;
            debugLog.scrollTop = debugLog.scrollHeight;
            
            console.log(message);
        }

        function updateStatus(message, isError = false) {
            systemStatus.innerHTML = isError ? 
                `<div class="error">${message}</div>` : 
                `<div class="success">${message}</div>`;
        }

        window.clearLog = function() {
            debugLog.textContent = 'Log limpiado...\n';
        }

        window.testBasicImports = async function() {
            log('=== PROBANDO IMPORTACIONES BÁSICAS ===');
            
            try {
                // Probar importación de configuración
                log('Importando GameConfig...');
                const { getFullConfig } = await import('./src/config/GameConfig.js');
                const config = getFullConfig();
                log('✅ GameConfig importado correctamente');
                log(`Configuración canvas: ${config.canvas.width}x${config.canvas.height}`);

                // Probar importación de textos
                log('Importando SpanishText...');
                const { SPANISH_TEXT } = await import('./src/config/SpanishText.js');
                log('✅ SpanishText importado correctamente');
                log(`Texto de inicio: "${SPANISH_TEXT.START_GAME}"`);

                updateStatus('✅ Importaciones básicas funcionando');
                
            } catch (error) {
                log(`❌ Error en importaciones básicas: ${error.message}`);
                log(`Stack: ${error.stack}`);
                updateStatus(`❌ Error: ${error.message}`, true);
            }
        }

        window.testEventBus = async function() {
            log('=== PROBANDO EVENTBUS ===');
            
            try {
                log('Importando EventBus...');
                const { EventBus } = await import('./src/core/EventBus.js');
                
                log('Creando instancia de EventBus...');
                const eventBus = new EventBus();
                
                log('Probando eventos...');
                let testPassed = false;
                
                eventBus.on('test:event', (data) => {
                    log(`✅ Evento recibido: ${data.message}`);
                    testPassed = true;
                });
                
                eventBus.emit('test:event', { message: 'Hola desde EventBus!' });
                
                if (testPassed) {
                    log('✅ EventBus funcionando correctamente');
                    updateStatus('✅ EventBus funcionando');
                } else {
                    throw new Error('EventBus no procesó el evento');
                }
                
            } catch (error) {
                log(`❌ Error en EventBus: ${error.message}`);
                updateStatus(`❌ Error EventBus: ${error.message}`, true);
            }
        }

        window.testConfigManager = async function() {
            log('=== PROBANDO CONFIGMANAGER ===');
            
            try {
                log('Importando ConfigManager...');
                const { ConfigManager } = await import('./src/core/ConfigManager.js');
                
                log('Creando instancia de ConfigManager...');
                const configManager = new ConfigManager({ test: { value: 123 } });
                
                log('Probando get/set...');
                const testValue = configManager.get('test.value');
                log(`Valor obtenido: ${testValue}`);
                
                if (testValue === 123) {
                    log('✅ ConfigManager funcionando correctamente');
                    updateStatus('✅ ConfigManager funcionando');
                } else {
                    throw new Error(`Valor esperado: 123, obtenido: ${testValue}`);
                }
                
            } catch (error) {
                log(`❌ Error en ConfigManager: ${error.message}`);
                updateStatus(`❌ Error ConfigManager: ${error.message}`, true);
            }
        }

        window.testGameEngine = async function() {
            log('=== PROBANDO GAMEENGINE ===');
            
            try {
                log('Importando GameEngine...');
                const { GameEngine } = await import('./src/core/GameEngine.js');
                
                log('Importando configuración...');
                const { getFullConfig } = await import('./src/config/GameConfig.js');
                const config = getFullConfig();
                
                log('Creando instancia de GameEngine...');
                const gameEngine = new GameEngine(config);
                
                log('Verificando propiedades del GameEngine...');
                log(`EventBus presente: ${!!gameEngine.eventBus}`);
                log(`StateManager presente: ${!!gameEngine.stateManager}`);
                log(`Canvas presente: ${!!gameEngine.canvas}`);
                log(`Context presente: ${!!gameEngine.context}`);
                
                if (gameEngine.eventBus && gameEngine.stateManager) {
                    log('✅ GameEngine creado correctamente');
                    updateStatus('✅ GameEngine funcionando');
                    
                    // Probar cambio de estado
                    log('Probando cambio de estado...');
                    gameEngine.stateManager.changeState('menu');
                    log(`Estado actual: ${gameEngine.stateManager.getCurrentState()}`);
                    
                } else {
                    throw new Error('GameEngine no se inicializó correctamente');
                }
                
            } catch (error) {
                log(`❌ Error en GameEngine: ${error.message}`);
                log(`Stack: ${error.stack}`);
                updateStatus(`❌ Error GameEngine: ${error.message}`, true);
            }
        }

        // Ejecutar prueba inicial
        log('Debug Test iniciado');
        log('Haz clic en los botones para probar diferentes módulos');
        
        // Probar importaciones básicas automáticamente
        setTimeout(() => {
            testBasicImports();
        }, 1000);
    </script>
</body>
</html>