<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Sistema de Efectos Visuales Spikepulse</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0F0F0F;
            color: #FFFFFF;
            font-family: 'Courier New', monospace;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-canvas {
            border: 2px solid #FFD700;
            border-radius: 8px;
            box-shadow: 0 0 20px #FFD700;
            display: block;
            margin: 20px auto;
            background: #1A1A2E;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .control-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: none;
            border-radius: 6px;
            color: #000;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }
        
        .stats {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .stats h3 {
            margin: 0 0 10px 0;
            color: #FFD700;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 4px;
        }
        
        .stat-label {
            color: #9F7AEA;
            font-weight: bold;
        }
        
        .stat-value {
            color: #FFFFFF;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üî• Test del Sistema de Efectos Visuales Spikepulse</h1>
        
        <canvas id="testCanvas" class="test-canvas" width="800" height="400"></canvas>
        
        <div class="controls">
            <button class="control-btn" onclick="testPlayerJump()">Salto del Jugador</button>
            <button class="control-btn" onclick="testPlayerDash()">Dash del Jugador</button>
            <button class="control-btn" onclick="testGravityFlip()">Cambio de Gravedad</button>
            <button class="control-btn" onclick="testSpikeHit()">Colisi√≥n con Spike</button>
            <button class="control-btn" onclick="testAtmospheric()">Efectos Atmosf√©ricos</button>
            <button class="control-btn" onclick="testSpikepulsePulse()">Pulso Spikepulse</button>
            <button class="control-btn" onclick="testScreenShake()">Screen Shake</button>
            <button class="control-btn" onclick="clearAllEffects()">Limpiar Efectos</button>
        </div>
        
        <div class="stats" id="statsContainer">
            <h3>üìä Estad√≠sticas de Efectos en Tiempo Real</h3>
            <div class="stats-grid" id="statsGrid">
                <!-- Las estad√≠sticas se llenar√°n din√°micamente -->
            </div>
        </div>
        
        <div class="stats">
            <h3>üéÆ Instrucciones</h3>
            <p>‚Ä¢ Haz clic en los botones para probar diferentes efectos visuales</p>
            <p>‚Ä¢ Los efectos se renderizan en tiempo real en el canvas</p>
            <p>‚Ä¢ Las estad√≠sticas se actualizan autom√°ticamente</p>
            <p>‚Ä¢ Cada efecto tiene part√≠culas, glow y feedback visual espec√≠fico</p>
        </div>
    </div>

    <script type="module">
        import { EventBus } from './src/core/EventBus.js';
        import { EffectsManager } from './src/modules/renderer/EffectsManager.js';
        import { SpikepulseEffects } from './src/modules/renderer/SpikepulseEffects.js';
        import { SPIKEPULSE_CONFIG } from './src/config/GameConfig.js';

        // Configuraci√≥n global
        window.testEffectsSystem = null;
        window.testCanvas = null;
        window.testCtx = null;
        window.testEventBus = null;
        window.animationId = null;

        // Inicializar sistema de pruebas
        async function initializeTestSystem() {
            try {
                console.log('üöÄ Inicializando sistema de pruebas de efectos visuales...');
                
                // Configurar canvas
                window.testCanvas = document.getElementById('testCanvas');
                window.testCtx = window.testCanvas.getContext('2d');
                
                // Configurar event bus
                window.testEventBus = new EventBus();
                
                // Configurar gestores de efectos
                const effectsConfig = {
                    maxParticles: 500,
                    maxGlowEffects: 50,
                    maxTrailSegments: 200,
                    enablePooling: true
                };
                
                const effectsManager = new EffectsManager(effectsConfig, window.testEventBus);
                
                const spikepulseConfig = {
                    spikepulseEffects: {
                        enableAdvancedEffects: true,
                        particleQuality: 'high'
                    }
                };
                
                window.testEffectsSystem = new SpikepulseEffects(
                    effectsManager, 
                    spikepulseConfig.spikepulseEffects, 
                    window.testEventBus
                );
                
                console.log('‚úÖ Sistema de efectos inicializado correctamente');
                
                // Iniciar loop de renderizado
                startRenderLoop();
                
                // Iniciar actualizaci√≥n de estad√≠sticas
                startStatsUpdate();
                
            } catch (error) {
                console.error('‚ùå Error al inicializar sistema de pruebas:', error);
            }
        }

        // Loop de renderizado
        function startRenderLoop() {
            let lastTime = 0;
            
            function render(currentTime) {
                const deltaTime = currentTime - lastTime;
                lastTime = currentTime;
                
                // Limpiar canvas
                window.testCtx.fillStyle = '#1A1A2E';
                window.testCtx.fillRect(0, 0, window.testCanvas.width, window.testCanvas.height);
                
                // Actualizar y renderizar efectos
                if (window.testEffectsSystem && window.testEffectsSystem.effectsManager) {
                    window.testEffectsSystem.effectsManager.update(deltaTime);
                    
                    const renderState = {
                        frame: Math.floor(currentTime / 16.67),
                        deltaTime: deltaTime,
                        totalTime: currentTime,
                        canvasWidth: window.testCanvas.width,
                        canvasHeight: window.testCanvas.height
                    };
                    
                    window.testEffectsSystem.effectsManager.render(window.testCtx, renderState);
                }
                
                window.animationId = requestAnimationFrame(render);
            }
            
            window.animationId = requestAnimationFrame(render);
        }

        // Actualizaci√≥n de estad√≠sticas
        function startStatsUpdate() {
            function updateStats() {
                if (window.testEffectsSystem) {
                    const stats = window.testEffectsSystem.getEffectsStats();
                    const effectsMetrics = window.testEffectsSystem.effectsManager.getMetrics();
                    
                    const statsGrid = document.getElementById('statsGrid');
                    statsGrid.innerHTML = `
                        <div class="stat-item">
                            <span class="stat-label">Efectos Activos:</span>
                            <span class="stat-value">${stats.activeEffects}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Part√≠culas Activas:</span>
                            <span class="stat-value">${effectsMetrics.particlesActive}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Efectos de Glow:</span>
                            <span class="stat-value">${effectsMetrics.glowEffectsActive}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Trails Activos:</span>
                            <span class="stat-value">${effectsMetrics.trailsActive}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Efectos de Pantalla:</span>
                            <span class="stat-value">${effectsMetrics.screenEffectsActive}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Tiempo de Render:</span>
                            <span class="stat-value">${effectsMetrics.lastRenderTime.toFixed(2)}ms</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Presets Disponibles:</span>
                            <span class="stat-value">${stats.presets}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Renderizados:</span>
                            <span class="stat-value">${effectsMetrics.totalEffectsRendered}</span>
                        </div>
                    `;
                }
                
                setTimeout(updateStats, 100); // Actualizar cada 100ms
            }
            
            updateStats();
        }

        // Funciones de prueba globales
        window.testPlayerJump = function() {
            if (window.testEffectsSystem) {
                const position = {
                    x: Math.random() * (window.testCanvas.width - 100) + 50,
                    y: Math.random() * (window.testCanvas.height - 100) + 50
                };
                
                window.testEventBus.emit('player:jump', { position });
                console.log('ü¶ò Efecto de salto del jugador activado en:', position);
            }
        };

        window.testPlayerDash = function() {
            if (window.testEffectsSystem) {
                const position = {
                    x: Math.random() * (window.testCanvas.width - 100) + 50,
                    y: Math.random() * (window.testCanvas.height - 100) + 50
                };
                
                const direction = {
                    x: Math.random() > 0.5 ? 1 : -1,
                    y: (Math.random() - 0.5) * 0.5
                };
                
                window.testEventBus.emit('player:dash', { position, direction });
                console.log('üí® Efecto de dash del jugador activado en:', position);
            }
        };

        window.testGravityFlip = function() {
            if (window.testEffectsSystem) {
                const position = {
                    x: window.testCanvas.width / 2,
                    y: window.testCanvas.height / 2
                };
                
                window.testEventBus.emit('player:gravity-flip', { position });
                console.log('üîÑ Efecto de cambio de gravedad activado');
            }
        };

        window.testSpikeHit = function() {
            if (window.testEffectsSystem) {
                const position = {
                    x: Math.random() * (window.testCanvas.width - 100) + 50,
                    y: Math.random() * (window.testCanvas.height - 100) + 50
                };
                
                window.testEventBus.emit('player:hit-obstacle', { position });
                console.log('üí• Efecto de colisi√≥n con spike activado en:', position);
            }
        };

        window.testAtmospheric = function() {
            if (window.testEffectsSystem) {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const position = {
                            x: Math.random() * window.testCanvas.width,
                            y: Math.random() * window.testCanvas.height
                        };
                        
                        window.testEventBus.emit('world:atmospheric-effect', { position });
                        window.testEventBus.emit('world:industrial-sparks', { position });
                    }, i * 200);
                }
                console.log('üå´Ô∏è Efectos atmosf√©ricos activados');
            }
        };

        window.testSpikepulsePulse = function() {
            if (window.testEffectsSystem) {
                const position = {
                    x: window.testCanvas.width / 2,
                    y: window.testCanvas.height / 2
                };
                
                window.testEffectsSystem.createSpikepulsePulse(position, '#FFD700', 1.5);
                console.log('‚ö° Pulso Spikepulse activado');
            }
        };

        window.testScreenShake = function() {
            if (window.testEffectsSystem) {
                window.testEffectsSystem.createScreenShake(0.5, 8);
                console.log('üì≥ Screen shake activado');
            }
        };

        window.clearAllEffects = function() {
            if (window.testEffectsSystem) {
                window.testEffectsSystem.clearAllEffects();
                console.log('üßπ Todos los efectos limpiados');
            }
        };

        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', initializeTestSystem);
        
        // Limpiar al cerrar
        window.addEventListener('beforeunload', () => {
            if (window.animationId) {
                cancelAnimationFrame(window.animationId);
            }
        });
    </script>
</body>
</html>