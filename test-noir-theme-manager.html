<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test NoirThemeManager - Spikepulse</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .test-pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .demo-element {
            padding: 20px;
            margin: 10px 0;
            border: 2px solid #ccc;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        #gameCanvas {
            border: 2px solid #333;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>üéÆ Test NoirThemeManager - Spikepulse</h1>
    
    <div class="test-container">
        <h2>üìã Resultados de Tests</h2>
        <div id="test-results"></div>
    </div>
    
    <div class="test-container">
        <h2>üé® Demo Visual</h2>
        <p>Elementos que ser√°n transformados por el tema noir:</p>
        
        <canvas id="gameCanvas" width="400" height="200">Canvas del juego</canvas>
        
        <div class="demo-element spikepulse-btn">
            <button class="spikepulse-btn">Bot√≥n de Prueba</button>
        </div>
        
        <div class="demo-element spikepulse-screen">
            <div class="spikepulse-screen">Pantalla de Prueba</div>
        </div>
        
        <button onclick="applyNoirTheme()">üé≠ Aplicar Tema Noir</button>
        <button onclick="showStats()">üìä Mostrar Estad√≠sticas</button>
        <button onclick="testColorTransition()">üåà Test Transici√≥n de Colores</button>
    </div>
    
    <div class="test-container">
        <h2>üìä Estad√≠sticas del Sistema</h2>
        <div id="stats-display"></div>
    </div>

    <script type="module">
        import { NoirThemeManager } from './src/modules/themes/NoirThemeManager.js';
        import { EventBus } from './src/core/EventBus.js';
        
        // Variables globales para el test
        let themeManager;
        let eventBus;
        let testResults = [];
        
        // Configuraci√≥n mock para el test
        const mockConfig = {
            theme: {
                noir: {
                    enabled: true,
                    intensity: 1.0
                }
            }
        };
        
        // Funci√≥n para mostrar resultados de tests
        function displayTestResult(testName, passed, message = '') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            resultDiv.innerHTML = `
                <strong>${passed ? '‚úÖ' : '‚ùå'} ${testName}</strong>
                ${message ? `<br><small>${message}</small>` : ''}
            `;
            document.getElementById('test-results').appendChild(resultDiv);
            
            testResults.push({ testName, passed, message });
        }
        
        // Test de inicializaci√≥n
        function testInitialization() {
            try {
                eventBus = new EventBus();
                themeManager = new NoirThemeManager(mockConfig, eventBus);
                
                displayTestResult(
                    'Inicializaci√≥n del NoirThemeManager',
                    themeManager.isInitialized === true,
                    `Estado: ${themeManager.isInitialized ? 'Inicializado' : 'No inicializado'}`
                );
                
                displayTestResult(
                    'Tema actual es noir',
                    themeManager.currentTheme === 'noir',
                    `Tema actual: ${themeManager.currentTheme}`
                );
                
                displayTestResult(
                    'NoirPalette est√° disponible',
                    themeManager.noirPalette !== null,
                    'Paleta noir cargada correctamente'
                );
                
            } catch (error) {
                displayTestResult(
                    'Inicializaci√≥n del NoirThemeManager',
                    false,
                    `Error: ${error.message}`
                );
            }
        }
        
        // Test de aplicaci√≥n de tema
        function testThemeApplication() {
            try {
                themeManager.applyNoirTheme();
                
                const bodyHasNoirClass = document.body.classList.contains('spikepulse-noir-theme');
                displayTestResult(
                    'Aplicaci√≥n de clase noir al body',
                    bodyHasNoirClass,
                    `Clase aplicada: ${bodyHasNoirClass ? 'S√≠' : 'No'}`
                );
                
                const canvas = document.getElementById('gameCanvas');
                const canvasHasNoirClass = canvas.classList.contains('spikepulse-noir-canvas');
                displayTestResult(
                    'Aplicaci√≥n de clase noir al canvas',
                    canvasHasNoirClass,
                    `Clase aplicada: ${canvasHasNoirClass ? 'S√≠' : 'No'}`
                );
                
            } catch (error) {
                displayTestResult(
                    'Aplicaci√≥n de tema noir',
                    false,
                    `Error: ${error.message}`
                );
            }
        }
        
        // Test de obtenci√≥n de colores
        function testColorRetrieval() {
            try {
                const blackColor = themeManager.getColor('black');
                displayTestResult(
                    'Obtenci√≥n de color negro',
                    blackColor === '#000000',
                    `Color obtenido: ${blackColor}`
                );
                
                const palette = themeManager.getThemeColors();
                displayTestResult(
                    'Obtenci√≥n de paleta completa',
                    palette && palette.base && palette.transparencies,
                    `Secciones: ${Object.keys(palette).join(', ')}`
                );
                
            } catch (error) {
                displayTestResult(
                    'Obtenci√≥n de colores',
                    false,
                    `Error: ${error.message}`
                );
            }
        }
        
        // Test de preparaci√≥n para transici√≥n de colores
        function testColorTransitionPreparation() {
            try {
                themeManager.prepareColorTransition();
                
                const isReady = document.body.getAttribute('data-color-transition-ready') === 'true';
                displayTestResult(
                    'Preparaci√≥n para transici√≥n de colores',
                    isReady,
                    `Atributo configurado: ${isReady ? 'S√≠' : 'No'}`
                );
                
            } catch (error) {
                displayTestResult(
                    'Preparaci√≥n para transici√≥n de colores',
                    false,
                    `Error: ${error.message}`
                );
            }
        }
        
        // Funci√≥n para aplicar tema noir (bot√≥n)
        window.applyNoirTheme = function() {
            if (themeManager) {
                themeManager.applyNoirTheme();
                alert('¬°Tema noir aplicado! Revisa los elementos de la p√°gina.');
            }
        };
        
        // Funci√≥n para mostrar estad√≠sticas (bot√≥n)
        window.showStats = function() {
            if (themeManager) {
                const stats = themeManager.getStats();
                const statsDisplay = document.getElementById('stats-display');
                statsDisplay.innerHTML = `
                    <h3>üìà Estad√≠sticas del NoirThemeManager</h3>
                    <ul>
                        <li><strong>Inicializado:</strong> ${stats.isInitialized ? 'S√≠' : 'No'}</li>
                        <li><strong>Tema actual:</strong> ${stats.currentTheme}</li>
                        <li><strong>En transici√≥n:</strong> ${stats.isTransitioning ? 'S√≠' : 'No'}</li>
                        <li><strong>Variables CSS aplicadas:</strong> ${stats.appliedVariablesCount}</li>
                        <li><strong>Elementos observados:</strong> ${stats.observedElementsCount}</li>
                    </ul>
                    <h4>üìä Estad√≠sticas de la Paleta</h4>
                    <ul>
                        <li><strong>Inicializada:</strong> ${stats.paletteStats.isInitialized ? 'S√≠' : 'No'}</li>
                        <li><strong>Total de colores:</strong> ${stats.paletteStats.totalColors}</li>
                        <li><strong>Cache de colores:</strong> ${stats.paletteStats.cacheSize}</li>
                    </ul>
                `;
            }
        };
        
        // Funci√≥n para test de transici√≥n de colores (bot√≥n)
        window.testColorTransition = function() {
            if (themeManager) {
                themeManager.prepareColorTransition();
                alert('¬°Sistema preparado para transici√≥n de colores!');
            }
        };
        
        // Ejecutar todos los tests al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéÆ Iniciando tests del NoirThemeManager...');
            
            testInitialization();
            testThemeApplication();
            testColorRetrieval();
            testColorTransitionPreparation();
            
            // Mostrar resumen
            const passed = testResults.filter(r => r.passed).length;
            const total = testResults.length;
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${passed === total ? 'test-pass' : 'test-fail'}`;
            summaryDiv.innerHTML = `
                <strong>üìä Resumen: ${passed}/${total} tests pasaron</strong>
                <br><small>Tasa de √©xito: ${((passed/total) * 100).toFixed(1)}%</small>
            `;
            document.getElementById('test-results').appendChild(summaryDiv);
            
            console.log(`üéØ Tests completados: ${passed}/${total} pasaron`);
        });
    </script>
</body>
</html>